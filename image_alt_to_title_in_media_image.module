<?php

/**
 * @file
 * Provides form alters to hide the image Title field and copy Alt to Title.
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_field_widget_single_element_form_alter().
 */
function image_alt_to_title_in_media_image_field_widget_single_element_form_alter(array &$element, FormStateInterface $form_state, $context) {
  $field_definition = $context['items']->getFieldDefinition();
  
  // Only target the specific media image field to prevent breaking other forms.
  if ($field_definition && method_exists($field_definition, 'getName') && $field_definition->getName() === 'field_media_image') {
    /** @var \Drupal\image_alt_to_title_in_media_image\Form\FormImageFieldHandler $handler */
    $handler = \Drupal::service('image_alt_to_title_in_media_image.form_image_field_handler');
    
    // Use the corrected method name.
    $handler->hideTitleField($element);
    
    // Sync alt to title late in the process.
    $element['#after_build'][] = [$handler, 'afterBuildHideTitle'];
  }
}

/**
 * Implements hook_form_BASE_FORM_ID_alter() for media_library_widget_form.
 */
function image_alt_to_title_in_media_image_form_media_library_widget_form_alter(array &$form, FormStateInterface $form_state, $form_id) {
  $handler = \Drupal::service('image_alt_to_title_in_media_image.form_image_field_handler');
  $handler->alterMediaLibraryWidgetForm($form, $form_state);
}

/**
 * Implements hook_form_BASE_FORM_ID_alter() for media_form.
 */
function image_alt_to_title_in_media_image_form_media_form_alter(array &$form, FormStateInterface $form_state, $form_id) {
  $handler = \Drupal::service('image_alt_to_title_in_media_image.form_image_field_handler');
  $handler->alterForm($form, $form_state);
}
